# å¤¹çˆªç”µæœºç½‘é¡µæ§åˆ¶å™¨ (Gripper Motor Web Controller)

è¿™æ˜¯ä¸€ä¸ªé€šè¿‡ WebSocket å®ç°å®æ—¶ç½‘é¡µæ§åˆ¶è¾¾å¦™ç”µæœºï¼ˆDM-J4310-2ECï¼‰çš„ä¸Šä½æœºé¡¹ç›®ã€‚é¡¹ç›®é‡‡ç”¨ Python ä½œä¸ºåç«¯ï¼Œæ§åˆ¶ç”µæœºç¡¬ä»¶ï¼Œå¹¶é€šè¿‡ React æ„å»ºäº†ä¸€ä¸ªç¾è§‚ã€ä¸“ä¸šçš„ PC ç«¯æ§åˆ¶é¢æ¿ã€‚

## ğŸ¥ Demo

<p align="center">
  <img src="https://github.com/tianrking/SmartClaw-Console/raw/refs/heads/main/output.gif" alt="Project Demo GIF" width="100%">
</p>
<p align="center">
  <em>Project Feature Demo: Startup Calibration, Manual Control, and Automatic Mode Switching</em>
</p>

<p align="center">
  <img src="https://github.com/tianrking/SmartClaw-Console/raw/refs/heads/main/output2.gif" alt="Project Demo GIF" width="100%">
</p>
<p align="center">
  <em>Project Feature Demo: Working</em>
</p>

<p align="center">
  <img src="https://github.com/tianrking/SmartClaw-Console/raw/refs/heads/main/output3.gif" alt="Project Demo GIF" width="100%">
</p>
<p align="center">
  <em>Project Feature Demo: Simulation</em>
</p>



## âœ¨ ä¸»è¦åŠŸèƒ½

- **å¯åŠ¨æ—¶æ ‡å®š**: å¼•å¯¼ç”¨æˆ·æ‰‹åŠ¨è®¾ç½®å¤¹çˆªçš„ç‰©ç†æé™ï¼Œç¡®ä¿è¿åŠ¨èŒƒå›´çš„ç²¾ç¡®æ€§ã€‚
- **å®æ—¶é€šä¿¡**: åŸºäº WebSocketï¼Œå®ç°å‰ç«¯ä¸ç¡¬ä»¶ä¹‹é—´çš„ä½å»¶è¿ŸåŒå‘é€šä¿¡ã€‚
- **PCä¼˜åŒ–ä»ªè¡¨ç›˜**: ä½¿ç”¨ React æ„å»ºçš„ç°ä»£åŒ–ã€ç¾è§‚çš„ä¸¤æ å¼ç½‘é¡µå¸ƒå±€ï¼Œä¸“ä¸ºç”µè„‘è®¿é—®ä¼˜åŒ–ã€‚
- **å¤šç§æ§åˆ¶æ¨¡å¼**:
    - **è‡ªåŠ¨æ¨¡å¼**: ä¸€é”®æ‰§è¡ŒæŠ“å–ã€é‡Šæ”¾ã€å¾€å¤è¿åŠ¨ã€‚
    - **æ‰‹åŠ¨æ¨¡å¼**: é€šè¿‡æ‹–åŠ¨æ»‘å—ï¼Œå®æ—¶ã€ç²¾ç¡®æ§åˆ¶å¤¹çˆªçš„å¼€åˆè§’åº¦ã€‚
- **å®æ—¶å‚æ•°è°ƒèŠ‚**:
    - **åŠ›çŸ©è°ƒèŠ‚**: åœ¨ç½‘é¡µä¸Šå®æ—¶è°ƒæ•´åŠ›çŸ©æ¨¡å¼ä¸‹çš„é©±åŠ¨åŠ›çŸ©å¤§å°ã€‚
- **çŠ¶æ€å®æ—¶æ˜¾ç¤º**: åœ¨ç½‘é¡µä¸Šå®æ—¶å±•ç¤ºç”µæœºçš„å½“å‰æ¨¡å¼ã€ä½ç½®ã€åé¦ˆåŠ›çŸ©ç­‰æ ¸å¿ƒçŠ¶æ€ã€‚

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ backend/         # Python åç«¯ä»£ç 
â”‚   â”œâ”€â”€ DM_CAN.py    # ç”µæœºé©±åŠ¨åº“ (æ ¸å¿ƒ)
â”‚   â””â”€â”€ server_ws_manual.py  # ä¸»è¿è¡Œç¨‹åº (æœ€æ–°çš„WebSocketç‰ˆæœ¬)
â”œâ”€â”€ frontend/        # React å‰ç«¯ä»£ç 
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ App.jsx  # React ä¸»ç»„ä»¶
â”‚   â”‚   â””â”€â”€ App.css  # ä¸»æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ package.json # å‰ç«¯ä¾èµ–
â””â”€â”€ README.md        # æœ¬æ–‡æ¡£
```

## ğŸ› ï¸ ç¯å¢ƒå‡†å¤‡ (Prerequisites)

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„ç³»ç»Ÿå·²å®‰è£…ä»¥ä¸‹è½¯ä»¶ï¼š

1.  **Python 3.8+**
2.  **Node.js v16+** å’Œ **npm**
3.  ç¡¬ä»¶è¿æ¥ï¼šç¡®ä¿è¾¾å¦™ç”µæœºå·²é€šè¿‡ä¸²å£æ­£ç¡®è¿æ¥åˆ°æ‚¨çš„è®¡ç®—æœºã€‚

## ğŸš€ å®‰è£…ä¸å¯åŠ¨

### 1. å…‹éš†é¡¹ç›®ä»“åº“

æ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯ï¼Œå¹¶è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
git clone https://github.com/tianrking/SmartClaw-Console
cd SmartClaw-Console 
```

### 2. åç«¯é…ç½®

```bash
# è¿›å…¥åç«¯ç›®å½•
cd backend

# (æ¨è) åˆ›å»ºå¹¶æ¿€æ´»Pythonè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate

# å®‰è£…Pythonä¾èµ–
pip install websockets pyserial numpy
```
**é‡è¦æç¤º**: æ‚¨éœ€è¦ä¿®æ”¹ `backend/server_ws_manual.py` æ–‡ä»¶ä¸­çš„ä¸²å£å·ï¼ˆ`port`ï¼‰ä»¥åŒ¹é…æ‚¨çš„ç¡¬ä»¶ã€‚
- **å¦‚ä½•æŸ¥æ‰¾ä¸²å£å·ï¼Ÿ**
  1. å°†æ‚¨çš„ USB CAN è®¾å¤‡è¿æ¥åˆ°ç”µè„‘ã€‚
  2. åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå®ƒä¼šåˆ—å‡ºæ‰€æœ‰å¯èƒ½çš„ä¸²å£è®¾å¤‡ï¼š
     ```bash
     ls /dev | grep -E 'ttyUSB|ttyACM'
     ```
  3. å‘½ä»¤çš„è¾“å‡ºç»“æœï¼ˆä¾‹å¦‚ `ttyACM0` æˆ– `ttyUSB0`ï¼‰å°±æ˜¯æ‚¨éœ€è¦çš„ä¸²å£åç§°ã€‚
  4. å°† `server_ws_manual.py` æ–‡ä»¶ä¸­ `port='/dev/ttyACM0'` è¿™ä¸€è¡Œçš„å€¼ä¿®æ”¹ä¸ºæ‚¨æ‰¾åˆ°çš„åç§°ã€‚

### 3. å‰ç«¯é…ç½®

```bash
# è¿”å›é¡¹ç›®æ ¹ç›®å½•
cd ..
# è¿›å…¥å‰ç«¯ç›®å½•
cd frontend

# å®‰è£…Node.jsä¾èµ–
npm install
```

### 4. å¯åŠ¨é¡¹ç›®

ä¸ºäº†è¿è¡Œæ­¤é¡¹ç›®ï¼Œæ‚¨éœ€è¦åŒæ—¶å¯åŠ¨åç«¯æœåŠ¡å’Œå‰ç«¯æœåŠ¡ã€‚å»ºè®®ä½¿ç”¨ä¸¤ä¸ªç‹¬ç«‹çš„ç»ˆç«¯çª—å£æ¥åˆ†åˆ«ç®¡ç†å®ƒä»¬ã€‚

**ç»ˆç«¯ 1: å¯åŠ¨åç«¯æœåŠ¡**

```bash
# ç¡®ä¿æ‚¨ä½äºé¡¹ç›®æ ¹ç›®å½•
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ (å¦‚æœå·²åˆ›å»º)
source backend/venv/bin/activate

# è¿è¡Œ Python WebSocket æœåŠ¡å™¨
python3 backend/server_ws_manual.py
```
*æ‚¨åº”è¯¥ä¼šçœ‹åˆ°æœåŠ¡å™¨å¯åŠ¨å¹¶å¼€å§‹ç›‘å¬ `ws://0.0.0.0:8765` çš„æ—¥å¿—ã€‚è¯·ä¿æŒæ­¤ç»ˆç«¯çª—å£è¿è¡Œã€‚*

**ç»ˆç«¯ 2: å¯åŠ¨å‰ç«¯æœåŠ¡**

```bash
# æ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯çª—å£ï¼Œå¹¶ç¡®ä¿æ‚¨ä½äºé¡¹ç›®æ ¹ç›®å½•
cd frontend

# è¿è¡Œ React å¼€å‘æœåŠ¡å™¨
npm run dev
```
*æ‚¨ä¼šçœ‹åˆ°ä¸€ä¸ªæœ¬åœ°ç½‘å€ï¼ˆé€šå¸¸æ˜¯ `http://localhost:5173`ï¼‰ã€‚åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æ­¤åœ°å€ã€‚*

## ğŸ® æ“ä½œæµç¨‹

### 1. ç¡¬ä»¶æ ‡å®š (Calibration)

å½“æ‚¨ç¬¬ä¸€æ¬¡åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€å‰ç«¯é¡µé¢æ—¶ï¼Œä¼šé¦–å…ˆè¿›å…¥**æ ‡å®šç•Œé¢**ã€‚è¿™æ˜¯ç¡®ä¿è½¯ä»¶æ§åˆ¶èŒƒå›´ä¸å¤¹çˆªç‰©ç†æé™ç²¾ç¡®åŒ¹é…çš„å…³é”®ä¸€æ­¥ã€‚

1.  **æ‰‹åŠ¨æ§åˆ¶**: ç•Œé¢ä¸Šä¼šæœ‰ä¸€ä¸ªâ€œæ‰‹åŠ¨æ§åˆ¶ä½ç½®â€çš„æ»‘å—ã€‚æ‹–åŠ¨æ­¤æ»‘å—ï¼Œå¯ä»¥è‡ªç”±åœ°ç§»åŠ¨å¤¹çˆªã€‚
2.  **è®¾å®šæœ€å°å€¼ (é—­åˆæé™)**: å°†å¤¹çˆª**å®Œå…¨é—­åˆ**åˆ°å…¶ç‰©ç†æé™ä½ç½®ï¼Œç„¶åç‚¹å‡» **`Set as MIN (Closed)`** æŒ‰é’®ã€‚æ‚¨ä¼šçœ‹åˆ°â€œRecorded Minâ€å­—æ®µæ›´æ–°ä¸ºå½“å‰çš„ä½ç½®è¯»æ•°ã€‚
3.  **è®¾å®šæœ€å¤§å€¼ (å¼ å¼€æé™)**: å°†å¤¹çˆª**å®Œå…¨å¼ å¼€**åˆ°å…¶ç‰©ç†æé™ä½ç½®ï¼Œç„¶åç‚¹å‡» **`Set as MAX (Open)`** æŒ‰é’®ã€‚â€œRecorded Maxâ€å­—æ®µå°†ä¼šæ›´æ–°ã€‚
4.  **ç¡®è®¤æ ‡å®š**: å½“æœ€å°å€¼å’Œæœ€å¤§å€¼éƒ½å·²è®¾å®šåï¼Œç‚¹å‡»ç»¿è‰²çš„ **`Confirm Calibration & Begin Operation`** æŒ‰é’®ã€‚

å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œç³»ç»Ÿå°†ä¿å­˜æ ‡å®šèŒƒå›´ï¼Œå¹¶è‡ªåŠ¨è·³è½¬åˆ°ä¸»æ§åˆ¶é¢æ¿ã€‚

### 2. ä¸»æ§åˆ¶é¢æ¿

åœ¨ä¸»æ§åˆ¶é¢æ¿ä¸­ï¼Œæ‚¨å¯ä»¥æ‰§è¡Œæ‰€æœ‰é«˜çº§æ“ä½œï¼Œå¦‚è‡ªåŠ¨æŠ“å–ã€å¾€å¤è¿åŠ¨ä»¥åŠå®æ—¶è°ƒèŠ‚åŠ›çŸ©å’Œä½ç½®ã€‚

## ğŸ“¡ WebSocket API æ¥å£è¯´æ˜

- **æœåŠ¡å™¨åœ°å€**: `ws://127.0.0.1:8765`
- **é€šä¿¡æ ¼å¼**: JSON

### â¡ï¸ å‰ç«¯ -> åç«¯ (å‘é€æŒ‡ä»¤)

| æŒ‡ä»¤ (`command`) | å€¼ (`value`) | æè¿° |
| :--------------- | :----------- | :--- |
| **æ ‡å®šæŒ‡ä»¤** | | |
| `set_min` | `null` | å°†ç”µæœºå½“å‰ä½ç½®è®°å½•ä¸ºæœ€å°å€¼ï¼ˆé—­åˆæé™ï¼‰ã€‚ |
| `set_max` | `null` | å°†ç”µæœºå½“å‰ä½ç½®è®°å½•ä¸ºæœ€å¤§å€¼ï¼ˆå¼ å¼€æé™ï¼‰ã€‚ |
| `confirm_calibration` | `null` | ç¡®è®¤æ ‡å®šï¼Œå®Œæˆè®¾ç½®å¹¶è¿›å…¥ä¸»æ§åˆ¶é¢æ¿ã€‚ |
| **æ“ä½œæŒ‡ä»¤** | | |
| `grasp`          | `null`       | æ‰§è¡ŒæŠ“å–åŠ¨ä½œã€‚ |
| `release`        | `null`       | æ‰§è¡Œé‡Šæ”¾åŠ¨ä½œã€‚ |
| `reciprocate`    | `null`       | æ‰§è¡Œå¾€å¤è¿åŠ¨ã€‚ |
| `stop`           | `null`       | åœæ­¢æ‰€æœ‰è¿åŠ¨ã€‚ |
| `set_position`   | `float`      | åˆ‡æ¢åˆ°æ‰‹åŠ¨æ¨¡å¼ï¼Œå¹¶è®¾å®šç›®æ ‡ä½ç½®ã€‚|
| `set_torque`     | `float`      | è®¾å®šåŠ›çŸ©æ¨¡å¼ä¸‹çš„é©±åŠ¨åŠ›çŸ©ã€‚|

### â¬…ï¸ åç«¯ -> å‰ç«¯ (å¹¿æ’­çŠ¶æ€)

åç«¯ä¼šä»¥çº¦ 10Hz çš„é¢‘ç‡ï¼ŒæŒç»­å‘æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯å¹¿æ’­çŠ¶æ€ä¿¡æ¯ã€‚

*æ¶ˆæ¯æ ¼å¼:*
```json
{
  "type": "status",
  "data": {
    "is_connected": true,
    "mode": "manual",
    "position": -3.49,
    "torque": 1.25,
    "min_angle": -3.78,
    "max_angle": -3.05,
    "target_position": -3.5,
    "move_torque": 0.8,
    "is_calibrated": true // å…³é”®çŠ¶æ€ï¼šå†³å®šå‰ç«¯æ˜¾ç¤ºå“ªä¸ªç•Œé¢
  }
}
